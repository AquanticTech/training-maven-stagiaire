## üöÄ Cr√©ation d'un module REST Hello World

### Cr√©ation et initialisation du service

Cr√©er un r√©pertoire restService qui contient le fichier `pom.xml` suivant
```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>2.5.4</version>
        <relativePath/> <!-- lookup parent from repository -->
    </parent>
    <groupId>com.example</groupId>
    <artifactId>rest-service</artifactId>
    <version>0.0.1-SNAPSHOT</version>
    <name>rest-service</name>
    <description>Module de service REST pour dire bonjour</description>

    <properties>
        <java.version>11</java.version>
    </properties>

    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>

        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
            </plugin>
        </plugins>
    </build>
</project>

```

### Cr√©er l'application
Dans le r√©pertoire src/main/java, cr√©er la classe App.java dans le package `com.example.restService`
```java
package com.example.restservice;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class Application {

    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
```

### Cr√©er le contr√¥leur Springboot qui va renvoyer Hello World

Avec ce code, une fois que vous d√©marrez l'application, vous pouvez acc√©der √†
`http://localhost:8080/hello` pour voir le message "Hello World.

N'oubliez pas d'ajouter ce module √† votre projet Maven parent pour qu'il soit reconnu comme un sous-module.
Vous pouvez le faire en ajoutant une section <modules> dans le pom.xml de votre projet parent et en y listant le nom de l'artifactId de ce module.


```java
package com.example.restservice;

import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class HelloController {

    @GetMapping("/hello")
    public String sayHello() {
        return "Hello World.";
    }
}
```

### Lancement de l'application springBoot

Pour lancer une application Spring Boot avec Maven, vous pouvez utiliser le plugin spring-boot-maven-plugin.
Voici la commande pour d√©marrer l'application :
```bash
mvn spring-boot:run

```

### Formatage pour que cela renvoie un objet exploitable par GraphQL ou en Json
Pour renvoyer un JSON adapt√© √† GraphQL, nous devons structurer la r√©ponse pour qu'elle soit facilement interrogeable par une requ√™te GraphQL. Voici comment vous pouvez modifier le service pour renvoyer un JSON :

#### Cr√©ez un mod√®le pour la r√©ponse :
```java
package com.example.restservice;

public class GreetingResponse {
private String greeting;

    public GreetingResponse(String greeting) {
        this.greeting = greeting;
    }

    public String getGreeting() {
        return greeting;
    }

    public void setGreeting(String greeting) {
        this.greeting = greeting;
    }
}
```

#### Modifiez le contr√¥leur pour renvoyer le mod√®le :
```java
package com.example.restservice;

import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class HelloController {

    @GetMapping("/hello")
    public GreetingResponse sayHello() {
        return new GreetingResponse("Hello World M. RASATAVOHARY");
    }
}
```

Avec ces modifications, lorsque vous acc√©dez √† http://localhost:8080/hello, vous obtiendrez une r√©ponse JSON comme celle-ci :
```json
{
"greeting": "Hello World M. RASATAVOHARY"
}
```

Cette structure est plus adapt√©e √† GraphQL car elle renvoie un objet avec des champs nomm√©s plut√¥t qu'une simple
cha√Æne de caract√®res. Si vous aviez un serveur GraphQL, vous pourriez alors interroger sp√©cifiquement le champ
greeting ou d'autres champs que vous pourriez ajouter √† l'avenir.

Ex√©cutez cette commande √† la racine du module (l√† o√π se trouve le pom.xml du module) pour d√©marrer l'application.
Une fois l'application d√©marr√©e, elle sera accessible √† l'adresse `http://localhost:8080/hello` comme mentionn√©
pr√©c√©demment.

### Structuration pour contextualiser et ajouter du multi-langue

Construisez un JSON GraphQL plus √©labor√© qui int√®gre des variations de la salutation "Hello" selon diff√©rents pays,
en adaptant la formulation en fonction des contextes sp√©cifiques.

D'accord, voici comment vous pouvez structurer le service pour renvoyer le JSON complexe bas√© sur les salutations dans diff√©rents pays et situations :

#### Mod√®les pour la r√©ponse :

#### GreetingSituation.java :

```java
package com.example.restservice;

public class GreetingSituation {
private String context;
private String greeting;

    public GreetingSituation(String context, String greeting) {
        this.context = context;
        this.greeting = greeting;
    }

    public String getContext() {
        return context;
    }

    public void setContext(String context) {
        this.context = context;
    }

    public String getGreeting() {
        return greeting;
    }

    public void setGreeting(String greeting) {
        this.greeting = greeting;
    }
}
```

#### CountryGreeting.java :

```java
package com.example.restservice;

import java.util.List;

public class CountryGreeting {
private String country;
private String language;
private List<GreetingSituation> situations;

    public CountryGreeting(String country, String language, List<GreetingSituation> situations) {
        this.country = country;
        this.language = language;
        this.situations = situations;
    }

    public String getCountry() {
        return country;
    }

    public void setCountry(String country) {
        this.country = country;
    }

    public String getLanguage() {
        return language;
    }

    public void setLanguage(String language) {
        this.language = language;
    }

    public List<GreetingSituation> getSituations() {
        return situations;
    }

    public void setSituations(List<GreetingSituation> situations) {
        this.situations = situations;
    }
}
```

#### Contr√¥leur pour renvoyer le mod√®le :

##### HelloController.java :

```java
package com.example.restservice;

import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.Arrays;
import java.util.List;

@RestController
public class HelloController {

    @GetMapping("/greetings")
    public List<CountryGreeting> getGreetings() {
        return Arrays.asList(
            new CountryGreeting("France", "French", Arrays.asList(
                new GreetingSituation("Formal", "Bonjour"),
                new GreetingSituation("Informal", "Salut")
            )),
            new CountryGreeting("Spain", "Spanish", Arrays.asList(
                new GreetingSituation("Formal", "Buenos d√≠as"),
                new GreetingSituation("Informal", "Hola")
            )),
            new CountryGreeting("Japan", "Japanese", Arrays.asList(
                new GreetingSituation("Formal", "„Åì„Çì„Å´„Å°„ÅØ (Konnichiwa)"),
                new GreetingSituation("Informal", "„ÇÑ„ÅÇ (Yaa)")
            ))
        );
    }
}
```

Avec ce code, lorsque vous acc√©dez √† [http://localhost:8080/greetings](http://localhost:8080/greetings),
vous obtiendrez la structure JSON complexe des salutations dans diff√©rents pays et situations.

### Ajout d'une route qui permet de r√©cup√©rer des √©l√©ments en fonction de la langue

#### Ajout d'une Route

Ajoutez une route qui prend en compte la langue et la situation comme param√®tres et renvoie la salutation correspondante.

#### Mise √† jour du contr√¥leur

**Modifiez le fichier `HelloController.java` pour int√©grer la nouvelle route :**

```java
package com.example.restservice;

import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import java.util.Arrays;
import java.util.List;
import java.util.Optional;

@RestController
public class HelloController {

    private final List<CountryGreeting> greetings = Arrays.asList(
        new CountryGreeting("France", "French", Arrays.asList(
            new GreetingSituation("Formal", "Bonjour"),
            new GreetingSituation("Informal", "Salut")
        )),
        new CountryGreeting("Spain", "Spanish", Arrays.asList(
            new GreetingSituation("Formal", "Buenos d√≠as"),
            new GreetingSituation("Informal", "Hola")
        )),
        new CountryGreeting("Japan", "Japanese", Arrays.asList(
            new GreetingSituation("Formal", "„Åì„Çì„Å´„Å°„ÅØ (Konnichiwa)"),
            new GreetingSituation("Informal", "„ÇÑ„ÅÇ (Yaa)")
        ))
    );

    @GetMapping("/greetings")
    public List<CountryGreeting> getGreetings() {
        return greetings;
    }

    @GetMapping("/greeting")
    public String getGreetingByLanguageAndSituation(
            @RequestParam String language,
            @RequestParam String situation) {
        for (CountryGreeting countryGreeting : greetings) {
            if (countryGreeting.getLanguage().equalsIgnoreCase(language)) {
                for (GreetingSituation greetingSituation : countryGreeting.getSituations()) {
                    if (greetingSituation.getContext().equalsIgnoreCase(situation)) {
                        return greetingSituation.getGreeting();
                    }
                }
            }
        }
        return "Salutation non trouv√©e pour la langue et la situation sp√©cifi√©es.";
    }
}
```

Avec cette mise √† jour, vous pouvez acc√©der √† la route [http://localhost:8080/greeting?language=French&situation=Formal](http://localhost:8080/greeting?language=French&situation=Formal)
pour obtenir la salutation "Bonjour".

Si vous fournissez une langue ou une situation non reconnue, le service renverra "Salutation non trouv√©e pour la langue et la situation sp√©cifi√©es.".


### Ajout d'une d√©pendance qui permet d'exposer une route Swagger de l'API REST

Le module expose deux routes REST que l'on peut documenter au format openAPI de la fa√ßon suivante :
```yml
openapi: 3.0.0
info:
  version: "1.0.0"
  title: "Hello Service API"
  description: "API pour obtenir des salutations bas√©es sur la langue et la situation."

paths:
  /greetings:
    get:
      summary: "Obtenir toutes les salutations"
      description: "Renvoie une liste de salutations pour diff√©rents pays et situations."
      responses:
        '200':
          description: "Liste des salutations par pays"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CountryGreeting'

  /greeting:
    get:
      summary: "Obtenir une salutation sp√©cifique"
      description: "Renvoie une salutation bas√©e sur la langue et la situation fournies."
      parameters:
        - name: language
          in: query
          description: "Langue pour laquelle obtenir la salutation."
          required: true
          schema:
            type: string
        - name: situation
          in: query
          description: "Situation pour laquelle obtenir la salutation (par exemple, 'Formal' ou 'Informal')."
          required: true
          schema:
            type: string
      responses:
        '200':
          description: "Salutation bas√©e sur la langue et la situation"
          content:
            text/plain:
              schema:
                type: string

components:
  schemas:
    GreetingSituation:
      type: object
      properties:
        context:
          type: string
          description: "Contexte de la salutation (par exemple, 'Formal' ou 'Informal')."
        greeting:
          type: string
          description: "Texte de la salutation."
    CountryGreeting:
      type: object
      properties:
        country:
          type: string
          description: "Nom du pays."
        language:
          type: string
          description: "Langue du pays."
        situations:
          type: array
          items:
            $ref: '#/components/schemas/GreetingSituation'

```
Si vous copiez / coller ce code dans la partie √©dition de code de https://editor.swagger.io/, vous pourrez visualiser la route associ√©e.

#### Documentation Swagger

#### Int√©gration de Swagger √† Spring Boot

Pour tester les routes avec Swagger, suivez ces √©tapes pour int√©grer Swagger √† votre projet Spring Boot :

#### 1. Ajouter les d√©pendances √† `pom.xml` :

```xml
<!-- Swagger dependencies -->
<dependency>
    <groupId>io.springfox</groupId>
    <artifactId>springfox-boot-starter</artifactId>
    <version>3.0.0</version>
</dependency>
```

### 2. Configurer Swagger

Cr√©ez une classe de configuration pour Swagger, par exemple `SwaggerConfig.java` :

```java
package com.example.restservice;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import springfox.documentation.builders.PathSelectors;
import springfox.documentation.builders.RequestHandlerSelectors;
import springfox.documentation.spi.DocumentationType;
import springfox.documentation.spring.web.plugins.Docket;
import springfox.documentation.swagger2.annotations.EnableSwagger2;

@Configuration
@EnableSwagger2
public class SwaggerConfig {
    @Bean
    public Docket api() {
        return new Docket(DocumentationType.SWAGGER_2)
                .select()
                .apis(RequestHandlerSelectors.basePackage("com.example.restservice"))
                .paths(PathSelectors.any())
                .build();
    }
}
```

### 3. Lancer votre application Spring Boot

Si vous utilisez Maven, ex√©cutez la commande suivante √† la racine de votre projet :

```bash
mvn spring-boot:run
```

### 4. Acc√©der √† l'interface Swagger UI

Ouvrez votre navigateur et acc√©dez √† :

```
http://localhost:8080/swagger-ui/
```
Vous verrez l'interface Swagger UI avec vos routes list√©es. Vous pouvez cliquer sur chaque route pour voir les d√©tails et m√™me tester les routes directement depuis l'interface.

## Ajout d'une Route pour Afficher les Options

Pour faciliter l'utilisation des endpoints, vous pouvez ajouter une route qui affiche les options possibles de langue et
de situation. Voici comment proc√©der :

### 1. Mise √† jour du contr√¥leur `HelloController.java` :

```java
// ... (autres imports)
import java.util.Map;
//import java.util.stream.Collectors;

public class HellowWorld{
    // ... (d√©but de la classe HelloController)
    @GetMapping("/options")
    public Map<String, List<String>> getAvailableOptions() {
        Map<String, List<String>> options = greetings.stream()
                .collect(Collectors.toMap(
                        CountryGreeting::getLanguage,
                        countryGreeting -> countryGreeting.getSituations().stream()
                                .map(GreetingSituation::getContext)
                                .collect(Collectors.toList())
                ));
        return options;
    }
}
```

### 2. Explication :

La nouvelle route `/options` renvoie un objet JSON o√π chaque cl√© est une langue disponible et
chaque valeur est une liste des situations disponibles pour cette langue. Par exemple, le r√©sultat pourrait ressembler
√† ceci :

\```json
{
"French": ["Formal", "Informal"],
"Spanish": ["Formal", "Informal"],
"Japanese": ["Formal", "Informal"]
}
\```

### 3. Utilisation :

Apr√®s avoir ajout√© cette route, vous pouvez acc√©der √† `http://localhost:8080/options` pour obtenir la liste des
langues et des situations disponibles. Cela facilite l'utilisation des autres endpoints car les utilisateurs peuvent
d'abord consulter les options disponibles

##  üöÄ Cr√©ation d'un module Maven pour afficher le contenu du service REST

### 1. Initialisation du module Maven
Cr√©ez un nouveau module Maven en utilisant l'arch√©type `maven-archetype-webapp`.

```bash
mvn archetype:generate -DgroupId=com.example -DartifactId=jspmodule -DarchetypeArtifactId=maven-archetype-webapp -DinteractiveMode=false
```

### 2. Ajout des d√©pendances
Dans le fichier `pom.xml` du module, ajoutez les d√©pendances n√©cessaires pour Spring Boot, JSP et le client REST.

```xml
<dependencies>
    <!-- Spring Boot Starter Web -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    <!-- JSTL pour les tags JSP -->
    <dependency>
        <groupId>javax.servlet</groupId>
        <artifactId>jstl</artifactId>
    </dependency>
    <!-- Spring Boot Starter Data Rest pour le client REST -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-data-rest</artifactId>
    </dependency>
</dependencies>
```

### 3. Configuration de Spring Boot
Assurez-vous que votre classe principale √©tend `SpringBootServletInitializer` pour prendre en charge les JSP.

Dans votre module exercice-03.restService, par exemple √©crivez :
```java
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.boot.web.servlet.support.SpringBootServletInitializer;

@SpringBootApplication
public class App extends SpringBootServletInitializer {

    public static void main(String[] args) {
        SpringApplication.run(App.class, args);
    }
}
```


### 4. Cr√©ation de la page JSP
Dans le r√©pertoire `src/main/webapp/WEB-INF/views/`, cr√©ez un fichier `greeting.jsp` pour afficher le contenu du service REST.
Voici le code la page JSP
```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
    <title>Greeting Page</title>
</head>
<body>
    <h1>${message}</h1>
</body>
</html>
```


### 5. Contr√¥leur Spring Boot
Cr√©ez un contr√¥leur pour r√©cup√©rer les donn√©es du service REST et les transmettre √† la page JSP.
Voici le code de ce contr√¥leur
```java
package com.example.restservice;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;

@Controller
public class GreetingController {

    @GetMapping("/greeting-view")
    public String getGreeting(Model model) {
        // Ici, je suppose que vous avez un service ou une m√©thode pour obtenir le message.
        // Pour cet exemple, je vais simplement utiliser une cha√Æne statique.
        String greetingMessage = "Hello from Spring Boot!";
        model.addAttribute("message", greetingMessage);
        return "greeting";
    }
}
```


### 6. Configuration des vues
Dans `src/main/resources`, ajoutez ou modifiez le fichier `application.properties` pour configurer le pr√©fixe et le suffixe des vues.

```properties
spring.mvc.view.prefix=/WEB-INF/views/
spring.mvc.view.suffix=.jsp
```

### 7. Ex√©cution
Lancez votre application Spring Boot et acc√©dez √† la route appropri√©e pour voir le contenu du service REST affich√© √† l'aide de la page JSP.


## G√©n√©ration de fichiers `.jar` et `.war` pour votre application Spring Boot

### 1. Mise √† jour du fichier `pom.xml`

#### 1.1. Ajout de la d√©pendance `spring-boot-starter-tomcat`

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-tomcat</artifactId>
    <scope>provided</scope>
</dependency>
```

Cette d√©pendance garantit que Tomcat n'est pas inclus dans le fichier `.jar` car il est d√©j√† fourni par le conteneur
lors de l'ex√©cution du fichier `.war`.

#### 1.2. Configuration du plugin `spring-boot-maven-plugin`

```xml
<build>
    <plugins>
        <plugin>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-maven-plugin</artifactId>
            <executions>
                <execution>
                    <goals>
                        <goal>repackage</goal>
                    </goals>
                    <configuration>
                        <classifier>jar</classifier>
                    </configuration>
                </execution>
            </executions>
        </plugin>
    </plugins>
</build>
```

Le `<classifier>jar</classifier>` garantit que le fichier `.jar` est g√©n√©r√© avec un suffixe `-jar`.

### 2. G√©n√©ration des fichiers

Ex√©cutez la commande Maven suivante :

```bash
mvn clean package
```

Apr√®s l'ex√©cution, vous devriez voir deux fichiers dans le r√©pertoire `target` :

- `your-artifact-id.jar` : Le fichier `.jar` ex√©cutable.
- `your-artifact-id-war.jar` : Le fichier `.jar` avec le suffixe `-jar`.
- `your-artifact-id.war` : Le fichier `.war` pour le d√©ploiement.

### 3. Ex√©cution

Pour ex√©cuter le fichier `.jar` :

```bash
java -jar target/your-artifact-id.jar
```

Pour d√©ployer le fichier `.war`, copiez-le dans le r√©pertoire `webapps` de Tomcat et d√©marrez le serveur.

> **Note** : Remplacez `your-artifact-id` par l'ID d'artefact r√©el de votre projet.

